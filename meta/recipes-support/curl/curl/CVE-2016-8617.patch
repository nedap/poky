From 32ae8ba41b5dbf26dabe884ac4aa12597d1d96b9 Mon Sep 17 00:00:00 2001
From: Daniel Stenberg <daniel@haxx.se>
Date: Wed, 28 Sep 2016 00:05:12 +0200
Subject: [PATCH] base64: check for integer overflow on large input

Upstream-Status: Backport
CVE: CVE-2016-8617

Signed-off-by: Thiruvadi Rajaraman <trajaraman@mvista.com>

---
 lib/base64.c | 5 +++++
 1 file changed, 5 insertions(+)

Index: curl-7.50.1/lib/base64.c
===================================================================
--- curl-7.50.1.orig/lib/base64.c	2016-07-21 04:01:36.000000000 +0530
+++ curl-7.50.1/lib/base64.c	2017-06-12 17:06:30.865546695 +0530
@@ -190,6 +190,11 @@
   if(!insize)
     insize = strlen(indata);
 
+#if SIZEOF_SIZE_T == 4
+  if(insize > UINT_MAX/4)
+    return CURLE_OUT_OF_MEMORY;
+#endif
+
   base64data = output = malloc(insize * 4 / 3 + 4);
   if(!output)
     return CURLE_OUT_OF_MEMORY;
