commit 8cac017d35ef374e65acc98818a17cf8a652cbd0
Author: H.J. Lu <hjl.tools@gmail.com>
Date:   Thu Jun 15 08:21:48 2017 -0700

    i386-dis: Add 2 tests with invalid bnd register
    
    	PR binutils/21594
    	* testsuite/gas/i386/mpx.s: Add 2 tests with invalid bnd
    	register.
    	* testsuite/gas/i386/x86-64-mpx.s: Likewise.
    	* testsuite/gas/i386/mpx.d: Updated.
    	* testsuite/gas/i386/x86-64-mpx.d: Likewise.

Upstream-Status: Backport

CVE: CVE-2017-9755
Signed-off-by: Thiruvadi Rajaraman <trajaraman@mvista.com>

Index: git/gas/testsuite/gas/i386/mpx.d
===================================================================
--- git.orig/gas/testsuite/gas/i386/mpx.d	2017-09-21 15:45:57.640640603 +0530
+++ git/gas/testsuite/gas/i386/mpx.d	2017-09-21 15:45:57.616640460 +0530
@@ -130,4 +130,8 @@
 
 [a-f0-9]+ <foo>:
 [ 	]*[a-f0-9]+:	f2 c3                	bnd ret 
+
+[a-f0-9]+ <bad>:
+[ 	]*[a-f0-9]+:	0f 1a 30             	bndldx \(%eax\),\(bad\)
+[ 	]*[a-f0-9]+:	66 0f 1a c4          	bndmov \(bad\),%bnd0
 #pass
Index: git/gas/testsuite/gas/i386/mpx.s
===================================================================
--- git.orig/gas/testsuite/gas/i386/mpx.s	2017-09-21 15:45:57.640640603 +0530
+++ git/gas/testsuite/gas/i386/mpx.s	2017-09-21 15:45:57.616640460 +0530
@@ -157,3 +157,15 @@
 	bnd ret
 
 foo:	bnd ret
+
+bad:
+	# bndldx (%eax),(bad)
+	.byte 0x0f
+	.byte 0x1a
+	.byte 0x30
+
+	# bndmov (bad),%bnd0
+	.byte 0x66
+	.byte 0x0f
+	.byte 0x1a
+	.byte 0xc4
Index: git/gas/testsuite/gas/i386/x86-64-mpx.d
===================================================================
--- git.orig/gas/testsuite/gas/i386/x86-64-mpx.d	2017-09-21 15:45:57.640640603 +0530
+++ git/gas/testsuite/gas/i386/x86-64-mpx.d	2017-09-21 15:45:57.616640460 +0530
@@ -182,4 +182,8 @@
 
 [a-f0-9]+ <foo>:
 [ 	]*[a-f0-9]+:	f2 c3                	bnd retq 
+
+[a-f0-9]+ <bad>:
+[ 	]*[a-f0-9]+:	0f 1a 30             	bndldx \(%rax\),\(bad\)
+[ 	]*[a-f0-9]+:	66 0f 1a c4          	bndmov \(bad\),%bnd0
 #pass
Index: git/gas/testsuite/gas/i386/x86-64-mpx.s
===================================================================
--- git.orig/gas/testsuite/gas/i386/x86-64-mpx.s	2017-09-21 15:45:57.640640603 +0530
+++ git/gas/testsuite/gas/i386/x86-64-mpx.s	2017-09-21 15:45:57.616640460 +0530
@@ -209,3 +209,15 @@
 	bnd ret
 
 foo:	bnd ret
+
+bad:
+	# bndldx (%eax),(bad)
+	.byte 0x0f
+	.byte 0x1a
+	.byte 0x30
+
+	# bndmov (bad),%bnd0
+	.byte 0x66
+	.byte 0x0f
+	.byte 0x1a
+	.byte 0xc4
Index: git/gas/ChangeLog
===================================================================
--- git.orig/gas/ChangeLog	2017-09-21 15:38:53.143176323 +0530
+++ git/gas/ChangeLog	2017-09-21 15:48:07.134368927 +0530
@@ -1,3 +1,12 @@
+2017-06-15  H.J. Lu  <hongjiu.lu@intel.com>
+
+	PR binutils/21594
+	* testsuite/gas/i386/mpx.s: Add 2 tests with invalid bnd
+	register.
+	* testsuite/gas/i386/x86-64-mpx.s: Likewise.
+	* testsuite/gas/i386/mpx.d: Updated.
+	* testsuite/gas/i386/x86-64-mpx.d: Likewise.
+
 2016-12-01  Nick Clifton  <nickc@redhat.com>
 
 	PR gas/20898
